version: 2

models:
  - name: int_jira_join
    description: >
      The core issue table, enhanced with current-status attributes from foreign-key-related tables,
      and metrics regarding resolutions and assignments.
    columns:
      - name: issue_id
        description: Unique ID of the issue. 
        tests:
          - unique
          - not_null
      - name: issue_name
        description: Title of the issue.
      - name: last_updated_at
        description: Timestamp of when the issue was last updated in some way.
      - name: issue_type
        description: Name of the issue type (ie Epic, Task, Subtask, any custom types).
      - name: created_at
        description: Timestamp of when the issue was created (in UTC).
      - name: issue_description
        description: The issue description, if given.
      - name: due_date
        description: Calendar day on which the issue is due, if a due date is provided.
      - name: environment
        description: Text field describing the environment in which the issue occurred (ie "IE9 on Windows 7").
      - name: assignee_user_id
        description: Foreign key referencing the ID of the `user` currently assigned to this task.
      - name: assignee_name
        description: User display name of the person currently assigned this issue.
      - name: reporter_user_id
        description: >
          Foreign key referencing the ID of the `user` who reported the issue. This differs from the `issue.creator` column 
          in that the reporter can be changed in-app, though it is initialized as the creator.
      - name: reporter_name
        description: User display name of the person who reported the issue.
      - name: assignee_timezone
        description: Timezone of the user currently assigned this issue.
      - name: assignee_email
        description: Email associated with the user currently assigned this issue.
      - name: issue_key
        description: UI-facing id of the issue.
      - name: parent_issue_id
        description: Self-referencing ID of the parent `issue`.
      - name: parent_issue_key
        description: Issue key of the sub-issue's parent.
      - name: parent_issue_type
        description: Name of the type of issue that the parent is.
      - name: current_priority
        description: Name of the issue's current priority as it appears in the UI.
      - name: project_id
        description: Foreign key referencing the `project` that the issue belongs to.
      - name: project_name
        description: Title of the issue's project.
      - name: resolution_type
        description: Display name of the type of resolution that closed the issue.
      - name: resolved_at
        description: >
          Timestamp of when the issue was resolved (ie completed, marked as duplicate). If an issue
          is un-resolved, this will be null.
      - name: current_status
        description: Title of the category of status.
      - name: status_changed_at
        description: Timestamp of when the status was last changed.
      - name: epic_name
        description: Title of the issue's epic (it's `issue_name`, as all epics are issues).
      - name: epic_issue_id
        description: Self-referencing issue ID of the epic that this issue is associated with.
      - name: epic_key
        description: Issue key of the epic.
      - name: sprint_id
        description: Foreign key referencing the `sprint` that the issue is currently in.
      - name: sprint_name
        description: Title of the issue's sprint.
      - name: n_sprint_changes
        description: The total number of sprints that the issue has belonged to.
      - name: original_estimate_seconds
        description: The original estimate of how long working on this issue would take, in seconds.
      - name: remaining_estimate_seconds
        description: The estimate of how much longer working on this issue will take, in seconds.
      - name: time_spent_seconds
        description: The time that was spent working on this issue, in seconds.
      - name: work_ratio
        description: >
          The percentage of work that has been logged against the issue (time_spent) vs the original estimate of worktime.
          Equals -1.0 when the fields required for calculation are not provided.
      - name: conversation
        description: >
          Line-separated list of comments made on this issue, including the timestamp and author name of each comment.
      - name: n_comments
        description: The number of comments made on this issues. 
  
  - name: int_jira__project_metrics
    description: Table calculating issue-related metrics per project.
    columns:
      - name: project_id
        description: Unique ID of the project.
        tests:
          - unique
          - not_null
      - name: n_closed_issues
        description: The number of issues closed in this project.
      - name: n_open_issues
        description: The number of currently un-resolved issues in the project.
      - name: n_open_assigned_issues
        description: The number of currently open and currently assigned issues in the project.
      - name: avg_close_time_seconds
        description: The average time taken to close issues, in seconds.
      - name: avg_assigned_close_time_seconds
        description: The average time taken to close issues from their first assignment, in seconds.
      - name: avg_age_currently_open_seconds
        description: The average age of any currently-open issues.
      - name: avg_age_currently_open_assigned_seconds
        description: The average age of any currently-open issues, from their first assignment. 

  - name: int_jira__user_metrics
    description: Table calculating issue-related metrics per user.
    columns:
      - name: user_id  
        description: Unique ID of the user. 
        tests:
          - unique
          - not_null
      - name: n_closed_issues
        description: The number of issues that the user has closed (while being assigned to).
      - name: n_open_issues
        description: The number of currently open issues that the user is assigned to.
      - name: avg_close_time_seconds
        description: The average time taken to close issues since assignment, in seconds.
      - name: avg_age_currently_open_seconds 
        description: Tjhe average age of a user's currently open issues.

  - name: int_jira__epic
    description: Subset of `stg_jira__issue` in which the issue is an epic.
    columns:
      - name: issue_id
        description: Unique ID of the issue. 
        tests:
          - unique
          - not_null
      - name: assignee_user_id
        description: Foreign key referencing the ID of the `user` currently assigned to this task.
      - name: created_at
        description: Timestamp of when the issue was created (in UTC).
      - name: creator_user_id
        description: Foreign key referencing the `user` who first created the issue. Cannot be changed.
      - name: issue_description
        description: The issue description, if given.
      - name: due_date
        description: Calendar day on which the issue is due, if a due date is provided.
      - name: environment
        description: Text field describing the environment in which the issue occurred (ie "IE9 on Windows 7").
      - name: issue_type_id
        description: Foreign key referencing the ID of the `issue_type`. 
      - name: issue_key
        description: UI-facing id of the issue.
      - name: original_estimate_seconds
        description: The original estimate of how long working on this issue would take, in seconds.
      - name: parent_issue_id
        description: Self-referencing ID of the parent `issue`. 
      - name: priority_id
        description: Foreign key referencing the ID of the issue's current `priority`.
      - name: project_id
        description: Foreign key referencing the ID of the `project` that the issue belongs to.
      - name: remaining_estimate_seconds
        description: The estimate of how much longer working on this issue will take, in seconds.
      - name: reporter_user_id
        description: >
          Foreign key referencing the ID of the `user` who reported the issue. This differs from the `creator` column 
          in that the reporter can be changed in-app.
      - name: resolution_id
        description: Foreign key referencing the ID of the issue's type of `resolution`.
      - name: resolved_at
        description: >
          Timestamp of when the issue was resolved (ie completed, marked as duplicate). If an issue
          is un-resolved, this will be null.
      - name: status_id
        description: >
          Foreign key referencing the ID of the issue's `status` (the step that the issue is currently at 
          in the project's workflow).
      - name: status_changed_at
        description: Timestamp of when the status was last changed.
      - name: issue_name
        description: Title of the issue.
      - name: time_spent_seconds
        description: The time that was spent working on this issue, in seconds.
      - name: updated_at
        description: Timestamp of when the issue was last updated in some way.
      - name: work_ratio
        description: >
          The percentage of work that has been logged against the issue (time_spent) vs the original estimate of worktime.
          Equals -1.0 when the fields required for calculation are not provided.

  - name: int_jira__issue_comments
    description: Table aggregating issue comments into conversations.
    columns:
      - name: issue_id
        description: Unique ID of the issue.
        tests:
          - unique
          - not_null
      - name: conversation
        description: >
          Line-separated list of comments made on this issue, including the timestamp and author name of each comment.
      - name: n_comments
        description: The number of comments made on this issues. 

  - name: int_jira__issue_epic
    description: >
      Table associating issues with the epics they are linked to. This is necessary because issue-epic relationships
      are represented differently in next-gen vs classic projects. 
      In next-gen projects, epics are stored as an issue's parent issue, whereas in classic projects epics are 
      captured in the 'epic link' field in `issue_field_history`.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: 
            - issue_id  
            - epic_issue_id
    columns:
      - name: issue_id
        description: Unique ID of the issue. 
      - name: epic_issue_id
        description: Unique ID of the epic associated with this issue.
      - name: epic_name
        description: Name of the epic.
      - name: epic_key
        description: Issue key of the epic.

  - name: int_jira__issue_sprint
    description: Table relating issues to the sprints they currently belong to.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: 
            - issue_id  
            - sprint_id
    columns:
      - name: issue_id
        description: Unique ID of the issue. 
      - name: sprint_id
        description: Unique ID of the sprint.
      - name: sprint_name
        description: Title of the sprint.
      - name: board_id
        description: Foreign key referencing the ID of the `board` that the sprint lives in.
      - name: sprint_started_at
        description: Timestamp of when the sprint began. 
      - name: sprint_ended_at
        description: Timestamp of when the sprint is planned to end.
      - name: sprint_completed_at 
        description: Timestamp of when the sprint was completed.
      - name: n_sprint_changes
        description: The total number of sprints that the issue has belonged to.

  - name: int_jira__type_parents
    description: Table relating issues with data regarding their parent issues.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: 
            - issue_id  
            - parent_issue_id
    columns:
      - name: issue_id
        description: Unique ID of the issue.
      - name: parent_issue_id
        description: Unique ID of the parent issue.
      - name: issue_type
        description: Name of the issue type (ie Epic, Task, Subtask, any custom types).
      - name: issue_name
        description: Title of the issue.
      - name: issue_key
        description: UI-facing id of the issue.
      - name: parent_issue_type
        description: Name of the parent issue type (ie Epic, Task, Subtask, any custom types).
      - name: parent_issue_name
        description: Title of the parent issue.
      - name: parent_issue_key
        description: UI-facing id of the parent issue.
      - name: parent_is_epic
        description: Boolean that is true if the parent is a next-gen epic.
    
  - name: int_jira__users 
    description: Table relating issues to attributes about their assignees and reporters.
    columns:
      - name: issue_id
        description: Unique ID of the issue.
        tests:
          - unique
          - not_null
      - name: assignee_user_id
        description: Foreign key referencing the ID of the `user` currently assigned to this task.
      - name: assignee_name
        description: User display name of the person currently assigned this issue.
      - name: reporter_user_id
        description: >
          Foreign key referencing the ID of the `user` who reported the issue. This differs from the `issue.creator` column 
          in that the reporter can be changed in-app, though it is initialized as the creator.
      - name: reporter_name
        description: User display name of the person who reported the issue.
      - name: assignee_timezone
        description: Timezone of the user currently assigned this issue.
      - name: assignee_email
        description: Email associated with the user currently assigned this issue.
      - name: reporter_email
        description: Email associated with the user who reported this issue.
      - name: reporter_timezone
        description: Timezone of the user currently who reported this issue.

  - name: int_jira__agg_multiselect_history 
  - name: int_jira__combine_field_histories
  - name: int_jira__issue_calendar_spine
  - name: int_jira__pivot_daily_field_history